<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>SmartShop: A Real-Time, Sentiment-Driven E-commerce Recommendation System</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f5f5f5;
    }
    header {
      background-color: #0073e6;
      color: #fff;
      padding: 20px;
      text-align: center;
    }
    .container {
      max-width: 800px;
      margin: 40px auto;
      background-color: #fff;
      padding: 20px;
      border-radius: 4px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    input[type="text"] {
      width: 80%;
      padding: 10px;
      margin-right: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    button {
      padding: 10px 20px;
      background-color: #0073e6;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background-color: #005bb5;
    }
    .output {
      margin-top: 20px;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      background-color: #f0f0f0;
      min-height: 80px;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <header>
    <h1>SmartShop</h1>
    <p>A Real-Time, Sentiment-Driven E-commerce Recommendation System</p>
  </header>
  <div class="container">
    <h2>Review Summarizer</h2>
    <p>Enter the URL of the product to get the review summary:</p>
    <input type="text" id="productUrl" placeholder="Enter product URL here">
    <button id="summarizeBtn">Get Summary</button>
    <div class="output" id="output"></div>
  </div>
  
  <!-- Load Pyodide -->
  <script src="https://cdn.jsdelivr.net/pyodide/v0.21.3/full/pyodide.js"></script>
  <script>
    async function main() {
      // Load Pyodide runtime
      let pyodide = await loadPyodide();
      // Optionally install packages if needed (note that some packages may not work seamlessly)
      // await pyodide.runPythonAsync(`
      //   import micropip
      //   await micropip.install("beautifulsoup4")
      //   await micropip.install("requests")
      //   await micropip.install("transformers")
      // `);
      
      // Define Python code as a string
      const pythonCode = `
import sys
import requests
from bs4 import BeautifulSoup
from transformers import pipeline

def fetch_reviews(url):
    headers = {
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) "
                      "AppleWebKit/537.36 (KHTML, like Gecko) "
                      "Chrome/90.0.4430.93 Safari/537.36"
    }
    try:
        response = requests.get(url, headers=headers)
        response.raise_for_status()
    except Exception as e:
        return f"Error fetching page: {e}"
    soup = BeautifulSoup(response.content, "html.parser")
    review_elements = soup.find_all("span", {"data-hook": "review-body"})
    reviews = [elem.get_text(strip=True) for elem in review_elements]
    return " ".join(reviews)

def chunk_text(text, max_words=500):
    words = text.split()
    chunks = []
    for i in range(0, len(words), max_words):
        chunk = " ".join(words[i:i+max_words])
        chunks.append(chunk)
    return chunks

def summarize_text(text, model_name="facebook/bart-large-cnn"):
    summarizer = pipeline("summarization", model=model_name)
    if not text.strip():
        return "No content to summarize."
    words = text.split()
    if len(words) > 500:
        chunks = chunk_text(text, max_words=500)
    else:
        chunks = [text]
    summaries = []
    for chunk in chunks:
        try:
            summary_output = summarizer(chunk, max_length=150, min_length=40, do_sample=False)
            if summary_output and isinstance(summary_output, list) and "summary_text" in summary_output[0]:
                summaries.append(summary_output[0]['summary_text'])
            else:
                summaries.append("")
        except Exception as e:
            summaries.append(f"Error during summarization: {e}")
    overall_summary = " ".join(summaries).strip()
    return overall_summary if overall_summary else "Unable to generate summary."

def get_summary(url):
    reviews_text = fetch_reviews(url)
    if not reviews_text or reviews_text.startswith("Error"):
        return reviews_text
    summary = summarize_text(reviews_text)
    return summary

def summarize_url(url):
    return get_summary(url)
      `;
      // Execute the Python code to define functions
      await pyodide.runPythonAsync(pythonCode);
      
      // Get reference to the Python function
      const summarize_url = pyodide.globals.get("summarize_url");

      // Add event listener for button click
      document.getElementById("summarizeBtn").addEventListener("click", async () => {
        const url = document.getElementById("productUrl").value;
        document.getElementById("output").innerText = "Processing...";
        try {
          // Call the Python function
          let result = await summarize_url(url);
          document.getElementById("output").innerText = result.toString();
        } catch (error) {
          document.getElementById("output").innerText = "Error: " + error;
        }
      });
    }
    
    main();
  </script>
</body>
</html>
